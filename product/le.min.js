/*
 Copyright 2013 Logentries.
 Please view license at https://raw.github.com/logentries/le_js/master/LICENSE
*/
'use strict';(function(p,r){"function"===typeof define&&define.amd?define(function(){return r(p)}):"object"===typeof exports?("object"===typeof global&&(p=global),module.exports=r(p)):p.TT=r(p)})(this,function(p){function r(a){var k=a.token,h=a.secret,m=a.print,l=a.build,n=a.userId,q=a.userName,y=a.sessionId,w=a.device;if(null===w||"undefined"===typeof w)w="Browser: "+p.navigator.userAgent;var r;r=p.TTENDPOINT?p.TTENDPOINT:"api.traintracks.io/v1/events";var u;u="undefined"===typeof XDomainRequest?
a.ssl:"https:"===p.location.protocol?!0:!1;var c=[],t=!1,b=a.dry,z=function(){try{console.warn.apply(console,arguments)}catch(c){console.log.apply(console,arguments)}};this.log=function(a,A){if(!arguments.length)throw Error("No arguments!");if(!a||"string"!==typeof a)throw Error("Event type is required and should be string");var e={clientTimestamp:B(new Date),device:w,userId:n,userName:q,sessionId:y,build:l,eventType:a,data:A};return{level:function(d){if(m&&"undefined"!==typeof console&&"PAGE"!==
d)try{console[d.toLowerCase()].call(console,e)}catch(f){console.log(e)}return{send:function(){if("object"!==typeof e.data||e.data instanceof Array||null===e.data)z(a+" won't be sent since event is not an object");else{var d=[],f=JSON.stringify(e,function(c,b){if("undefined"===typeof b)return"undefined";if("object"===typeof b&&null!==b){var e;a:{for(e=0;e<d.length;e++)if(b===d[e])break a;e=-1}if(-1!==e)return"<?>";d.push(b)}return b});b||(t?c.push(f):x(k,h,"["+f+"]"))}}}}}};var x=function(b,a,e){t=
!0;var d;d="undefined"!==typeof XDomainRequest?new XDomainRequest:new XMLHttpRequest;d.constructor===XMLHttpRequest?d.onreadystatechange=function(){4===d.readyState&&(400<=d.status?(console.error("Couldn't submit events."),410===d.status&&console.warn("This version of le_js is no longer supported!")):(301===d.status&&console.warn("This version of le_js is deprecated! Consider upgrading."),0<c.length?(x(b,a,"["+c.join(",")+"]"),c=[]):t=!1))}:d.onload=function(){0<c.length?(x(b,a,"["+c.join(",")+"]"),
c=[]):t=!1};d.open("POST",(u?"https://":"http://")+r,!0);d.constructor===XMLHttpRequest&&(d.setRequestHeader("X-Requested-With","XMLHttpRequest"),d.setRequestHeader("Content-type","application/json;charset=utf-8"),d.setRequestHeader("X-Product-Key",b),d.setRequestHeader("X-Product-Auth",C(e+a)));d.send(e)}}function D(a){function k(a,h){if("string"===typeof a&&a.length||"number"===typeof a)return a.toString();throw Error(h+" is required and should be a string");}var h,m={ssl:!1,print:!1,dry:!1,endpoint:null,
token:null,secret:null,userId:null,userName:null,sessionId:null,build:null,device:null},l={token:k,secret:k,userId:k,userName:k,sessionId:k,build:k},n;if("object"===typeof a)for(n in a)m[n]=a[n];else throw Error("Invalid parameters for createLogStream()");for(n in l)m[n]=l[n](m[n],n);h=new r(m);var p=function(a){if(h)return h.log.apply(this,arguments);throw Error("You must call TT.init(...) first.");};return{log:function(){p.apply(this,arguments).level("LOG").send()}}}var q={},v=function(a){if("string"!==
typeof a.name)throw Error("Name not present.");if(q.hasOwnProperty(a.name))throw Error("A logger with that name already exists!");q[a.name]=new D(a);return!0},B=function(){function a(a,k,l){for(var n=""+Math.abs(a);n.length<k;)n="0"+n;return(0<=a?l?"+":"":"-")+n}function k(a){a=+a;var k=0;0!==a&&isFinite(a)&&(k=0<=a?Math.floor(a):Math.ceil(a));return k}return function(h){var m=h.getFullYear()+"-"+a(h.getMonth()+1,2)+"-"+a(h.getDate(),2)+"T"+a(h.getHours(),2)+":"+a(h.getMinutes(),2)+":"+a(h.getSeconds(),
2)+"."+a(k(1E3*h.getMilliseconds()),6);h=15*-Math.round(h.getTimezoneOffset()/15);var l="+";0>h&&(h=-h,l="-");h=l+a(k(h/60),2)+":"+a(k(h)%60,2);return m+h}}(),C=function(){function a(c,a){var b=(c&65535)+(a&65535);return(c>>16)+(a>>16)+(b>>16)<<16|b&65535}function k(c,t,b,h,k,l){c=a(a(t,c),a(h,l));return a(c<<k|c>>>32-k,b)}function h(c,a,b,h,l,m,n){return k(a&b|~a&h,c,a,l,m,n)}function m(c,a,b,h,l,m,n){return k(a&h|b&~h,c,a,l,m,n)}function l(c,a,b,h,l,m,n){return k(b^(a|~h),c,a,l,m,n)}function n(c,
t){c[t>>5]|=128<<t%32;c[(t+64>>>9<<4)+14]=t;var b,n,p,q,r,e=1732584193,d=-271733879,f=-1732584194,g=271733878;for(b=0;b<c.length;b+=16)n=e,p=d,q=f,r=g,e=h(e,d,f,g,c[b],7,-680876936),g=h(g,e,d,f,c[b+1],12,-389564586),f=h(f,g,e,d,c[b+2],17,606105819),d=h(d,f,g,e,c[b+3],22,-1044525330),e=h(e,d,f,g,c[b+4],7,-176418897),g=h(g,e,d,f,c[b+5],12,1200080426),f=h(f,g,e,d,c[b+6],17,-1473231341),d=h(d,f,g,e,c[b+7],22,-45705983),e=h(e,d,f,g,c[b+8],7,1770035416),g=h(g,e,d,f,c[b+9],12,-1958414417),f=h(f,g,e,d,c[b+
10],17,-42063),d=h(d,f,g,e,c[b+11],22,-1990404162),e=h(e,d,f,g,c[b+12],7,1804603682),g=h(g,e,d,f,c[b+13],12,-40341101),f=h(f,g,e,d,c[b+14],17,-1502002290),d=h(d,f,g,e,c[b+15],22,1236535329),e=m(e,d,f,g,c[b+1],5,-165796510),g=m(g,e,d,f,c[b+6],9,-1069501632),f=m(f,g,e,d,c[b+11],14,643717713),d=m(d,f,g,e,c[b],20,-373897302),e=m(e,d,f,g,c[b+5],5,-701558691),g=m(g,e,d,f,c[b+10],9,38016083),f=m(f,g,e,d,c[b+15],14,-660478335),d=m(d,f,g,e,c[b+4],20,-405537848),e=m(e,d,f,g,c[b+9],5,568446438),g=m(g,e,d,f,
c[b+14],9,-1019803690),f=m(f,g,e,d,c[b+3],14,-187363961),d=m(d,f,g,e,c[b+8],20,1163531501),e=m(e,d,f,g,c[b+13],5,-1444681467),g=m(g,e,d,f,c[b+2],9,-51403784),f=m(f,g,e,d,c[b+7],14,1735328473),d=m(d,f,g,e,c[b+12],20,-1926607734),e=k(d^f^g,e,d,c[b+5],4,-378558),g=k(e^d^f,g,e,c[b+8],11,-2022574463),f=k(g^e^d,f,g,c[b+11],16,1839030562),d=k(f^g^e,d,f,c[b+14],23,-35309556),e=k(d^f^g,e,d,c[b+1],4,-1530992060),g=k(e^d^f,g,e,c[b+4],11,1272893353),f=k(g^e^d,f,g,c[b+7],16,-155497632),d=k(f^g^e,d,f,c[b+10],23,
-1094730640),e=k(d^f^g,e,d,c[b+13],4,681279174),g=k(e^d^f,g,e,c[b],11,-358537222),f=k(g^e^d,f,g,c[b+3],16,-722521979),d=k(f^g^e,d,f,c[b+6],23,76029189),e=k(d^f^g,e,d,c[b+9],4,-640364487),g=k(e^d^f,g,e,c[b+12],11,-421815835),f=k(g^e^d,f,g,c[b+15],16,530742520),d=k(f^g^e,d,f,c[b+2],23,-995338651),e=l(e,d,f,g,c[b],6,-198630844),g=l(g,e,d,f,c[b+7],10,1126891415),f=l(f,g,e,d,c[b+14],15,-1416354905),d=l(d,f,g,e,c[b+5],21,-57434055),e=l(e,d,f,g,c[b+12],6,1700485571),g=l(g,e,d,f,c[b+3],10,-1894986606),f=
l(f,g,e,d,c[b+10],15,-1051523),d=l(d,f,g,e,c[b+1],21,-2054922799),e=l(e,d,f,g,c[b+8],6,1873313359),g=l(g,e,d,f,c[b+15],10,-30611744),f=l(f,g,e,d,c[b+6],15,-1560198380),d=l(d,f,g,e,c[b+13],21,1309151649),e=l(e,d,f,g,c[b+4],6,-145523070),g=l(g,e,d,f,c[b+11],10,-1120210379),f=l(f,g,e,d,c[b+2],15,718787259),d=l(d,f,g,e,c[b+9],21,-343485551),e=a(e,n),d=a(d,p),f=a(f,q),g=a(g,r);return[e,d,f,g]}function p(c){var a,b="";for(a=0;a<32*c.length;a+=8)b+=String.fromCharCode(c[a>>5]>>>a%32&255);return b}function q(c){var a,
b=[];b[(c.length>>2)-1]=void 0;for(a=0;a<b.length;a+=1)b[a]=0;for(a=0;a<8*c.length;a+=8)b[a>>5]|=(c.charCodeAt(a/8)&255)<<a%32;return b}function r(c){return p(n(q(c),8*c.length))}function v(c,a){var b,h=q(c),k=[],l=[];k[15]=l[15]=void 0;16<h.length&&(h=n(h,8*c.length));for(b=0;16>b;b+=1)k[b]=h[b]^909522486,l[b]=h[b]^1549556828;b=n(k.concat(q(a)),512+8*a.length);return p(n(l.concat(b),640))}function u(c){var a="",b,h;for(h=0;h<c.length;h+=1)b=c.charCodeAt(h),a+="0123456789abcdef".charAt(b>>>4&15)+
"0123456789abcdef".charAt(b&15);return a}return function(c,a,b){a?b?c=v(unescape(encodeURIComponent(a)),unescape(encodeURIComponent(c))):(c=v(unescape(encodeURIComponent(a)),unescape(encodeURIComponent(c))),c=u(c)):c=b?r(unescape(encodeURIComponent(c))):u(r(unescape(encodeURIComponent(c))));return c}}();return{init:function(a){var k={name:"default"};if("object"===typeof a)for(var h in a)k[h]=a[h];else throw Error("Invalid parameters for init()");return v(k)},createLogStream:v,to:function(a){if(!q.hasOwnProperty(a))throw Error("Invalid name for logStream");
return q[a]},destroy:function(a){"undefined"===typeof a&&(a="default");delete q[a]},log:function(){for(var a in q)q[a].log.apply(this,arguments)}}});
