/*
 Copyright 2013 Logentries.
 Please view license at https://raw.github.com/logentries/le_js/master/LICENSE
*/
'use strict';(function(p,r){"function"===typeof define&&define.amd?define(function(){return r(p)}):"object"===typeof exports?("object"===typeof global&&(p=global),module.exports=r(p)):p.TT=r(p)})(this,function(p){function r(b){var k=b.token,h=b.secret,m=b.print,l=b.build,n=b.userId,q=b.userName,z=b.sessionId,x=b.device;if(null===x||"undefined"===typeof x)x="Browser: "+p.navigator.userAgent;var r;r=p.TTENDPOINT?p.TTENDPOINT:"api.traintracks.io/v1/events";var v;v="undefined"===typeof XDomainRequest?
b.ssl:"https:"===p.location.protocol?!0:!1;var c=[],t=!1,a=function(){try{console.warn.apply(console,arguments)}catch(c){console.log.apply(console,arguments)}};this.log=function(b,A){if(!arguments.length)throw Error("No arguments!");if(!b||"string"!==typeof b)throw Error("Event type is required and should be string");var u={clientTimestamp:B(new Date),device:x,userId:n,userName:q,sessionId:z,build:l,eventType:b,data:A};return{level:function(d){if(m&&"undefined"!==typeof console&&"PAGE"!==d)try{console[d.toLowerCase()].call(console,
u)}catch(f){console.log(u)}return{send:function(){if("object"!==typeof u.data||u.data instanceof Array||null===u.data)a(b+" won't be sent since event is not an object");else{var d=[],e=JSON.stringify(u,function(c,a){if("undefined"===typeof a)return"undefined";if("object"===typeof a&&null!==a){var e;a:{for(e=0;e<d.length;e++)if(a===d[e])break a;e=-1}if(-1!==e)return"<?>";d.push(a)}return a});t?c.push(e):y(k,h,e)}}}}}};var y=function(a,b,h){t=!0;var d;d="undefined"!==typeof XDomainRequest?new XDomainRequest:
new XMLHttpRequest;d.constructor===XMLHttpRequest?d.onreadystatechange=function(){4===d.readyState&&(400<=d.status?(console.error("Couldn't submit events."),410===d.status&&console.warn("This version of le_js is no longer supported!")):(301===d.status&&console.warn("This version of le_js is deprecated! Consider upgrading."),0<c.length?(y(a,b,"["+c.join(",")+"]"),c=[]):t=!1))}:d.onload=function(){0<c.length?(y(a,b,"["+c.join(",")+"]"),c=[]):t=!1};d.open("POST",(v?"https://":"http://")+r,!0);d.constructor===
XMLHttpRequest&&(d.setRequestHeader("X-Requested-With","XMLHttpRequest"),d.setRequestHeader("Content-type","application/json;charset=utf-8"),d.setRequestHeader("X-Product-Key",a),d.setRequestHeader("X-Product-Auth",C(h+b)));d.send(h)}}function D(b){function k(b,h){if("string"===typeof b&&b.length||"number"===typeof b)return b.toString();throw Error(h+" is required and should be a string");}var h,m={ssl:!1,print:!1,endpoint:null,token:null,secret:null,userId:null,userName:null,sessionId:null,build:null,
device:null},l={token:k,secret:k,userId:k,userName:k,sessionId:k,build:k},n;if("object"===typeof b)for(n in b)m[n]=b[n];else throw Error("Invalid parameters for createLogStream()");for(n in l)m[n]=l[n](m[n],n);h=new r(m);var p=function(b){if(h)return h.log.apply(this,arguments);throw Error("You must call TT.init(...) first.");};return{log:function(){p.apply(this,arguments).level("LOG").send()}}}var q={},w=function(b){if("string"!==typeof b.name)throw Error("Name not present.");if(q.hasOwnProperty(b.name))throw Error("A logger with that name already exists!");
q[b.name]=new D(b);return!0},B=function(){function b(b,k,l){for(var n=""+Math.abs(b);n.length<k;)n="0"+n;return(0<=b?l?"+":"":"-")+n}function k(b){b=+b;var k=0;0!==b&&isFinite(b)&&(k=0<=b?Math.floor(b):Math.ceil(b));return k}return function(h){var m=h.getFullYear()+"-"+b(h.getMonth()+1,2)+"-"+b(h.getDate(),2)+"T"+b(h.getHours(),2)+":"+b(h.getMinutes(),2)+":"+b(h.getSeconds(),2)+"."+b(k(1E3*h.getMilliseconds()),6);h=15*-Math.round(h.getTimezoneOffset()/15);var l="+";0>h&&(h=-h,l="-");h=l+b(k(h/60),
2)+":"+b(k(h)%60,2);return m+h}}(),C=function(){function b(c,b){var a=(c&65535)+(b&65535);return(c>>16)+(b>>16)+(a>>16)<<16|a&65535}function k(c,t,a,h,k,l){c=b(b(t,c),b(h,l));return b(c<<k|c>>>32-k,a)}function h(c,b,a,h,l,m,n){return k(b&a|~b&h,c,b,l,m,n)}function m(c,b,a,h,l,m,n){return k(b&h|a&~h,c,b,l,m,n)}function l(c,b,a,h,l,m,n){return k(a^(b|~h),c,b,l,m,n)}function n(c,t){c[t>>5]|=128<<t%32;c[(t+64>>>9<<4)+14]=t;var a,n,p,q,r,d=1732584193,f=-271733879,g=-1732584194,e=271733878;for(a=0;a<c.length;a+=
16)n=d,p=f,q=g,r=e,d=h(d,f,g,e,c[a],7,-680876936),e=h(e,d,f,g,c[a+1],12,-389564586),g=h(g,e,d,f,c[a+2],17,606105819),f=h(f,g,e,d,c[a+3],22,-1044525330),d=h(d,f,g,e,c[a+4],7,-176418897),e=h(e,d,f,g,c[a+5],12,1200080426),g=h(g,e,d,f,c[a+6],17,-1473231341),f=h(f,g,e,d,c[a+7],22,-45705983),d=h(d,f,g,e,c[a+8],7,1770035416),e=h(e,d,f,g,c[a+9],12,-1958414417),g=h(g,e,d,f,c[a+10],17,-42063),f=h(f,g,e,d,c[a+11],22,-1990404162),d=h(d,f,g,e,c[a+12],7,1804603682),e=h(e,d,f,g,c[a+13],12,-40341101),g=h(g,e,d,f,
c[a+14],17,-1502002290),f=h(f,g,e,d,c[a+15],22,1236535329),d=m(d,f,g,e,c[a+1],5,-165796510),e=m(e,d,f,g,c[a+6],9,-1069501632),g=m(g,e,d,f,c[a+11],14,643717713),f=m(f,g,e,d,c[a],20,-373897302),d=m(d,f,g,e,c[a+5],5,-701558691),e=m(e,d,f,g,c[a+10],9,38016083),g=m(g,e,d,f,c[a+15],14,-660478335),f=m(f,g,e,d,c[a+4],20,-405537848),d=m(d,f,g,e,c[a+9],5,568446438),e=m(e,d,f,g,c[a+14],9,-1019803690),g=m(g,e,d,f,c[a+3],14,-187363961),f=m(f,g,e,d,c[a+8],20,1163531501),d=m(d,f,g,e,c[a+13],5,-1444681467),e=m(e,
d,f,g,c[a+2],9,-51403784),g=m(g,e,d,f,c[a+7],14,1735328473),f=m(f,g,e,d,c[a+12],20,-1926607734),d=k(f^g^e,d,f,c[a+5],4,-378558),e=k(d^f^g,e,d,c[a+8],11,-2022574463),g=k(e^d^f,g,e,c[a+11],16,1839030562),f=k(g^e^d,f,g,c[a+14],23,-35309556),d=k(f^g^e,d,f,c[a+1],4,-1530992060),e=k(d^f^g,e,d,c[a+4],11,1272893353),g=k(e^d^f,g,e,c[a+7],16,-155497632),f=k(g^e^d,f,g,c[a+10],23,-1094730640),d=k(f^g^e,d,f,c[a+13],4,681279174),e=k(d^f^g,e,d,c[a],11,-358537222),g=k(e^d^f,g,e,c[a+3],16,-722521979),f=k(g^e^d,f,
g,c[a+6],23,76029189),d=k(f^g^e,d,f,c[a+9],4,-640364487),e=k(d^f^g,e,d,c[a+12],11,-421815835),g=k(e^d^f,g,e,c[a+15],16,530742520),f=k(g^e^d,f,g,c[a+2],23,-995338651),d=l(d,f,g,e,c[a],6,-198630844),e=l(e,d,f,g,c[a+7],10,1126891415),g=l(g,e,d,f,c[a+14],15,-1416354905),f=l(f,g,e,d,c[a+5],21,-57434055),d=l(d,f,g,e,c[a+12],6,1700485571),e=l(e,d,f,g,c[a+3],10,-1894986606),g=l(g,e,d,f,c[a+10],15,-1051523),f=l(f,g,e,d,c[a+1],21,-2054922799),d=l(d,f,g,e,c[a+8],6,1873313359),e=l(e,d,f,g,c[a+15],10,-30611744),
g=l(g,e,d,f,c[a+6],15,-1560198380),f=l(f,g,e,d,c[a+13],21,1309151649),d=l(d,f,g,e,c[a+4],6,-145523070),e=l(e,d,f,g,c[a+11],10,-1120210379),g=l(g,e,d,f,c[a+2],15,718787259),f=l(f,g,e,d,c[a+9],21,-343485551),d=b(d,n),f=b(f,p),g=b(g,q),e=b(e,r);return[d,f,g,e]}function p(c){var b,a="";for(b=0;b<32*c.length;b+=8)a+=String.fromCharCode(c[b>>5]>>>b%32&255);return a}function q(c){var b,a=[];a[(c.length>>2)-1]=void 0;for(b=0;b<a.length;b+=1)a[b]=0;for(b=0;b<8*c.length;b+=8)a[b>>5]|=(c.charCodeAt(b/8)&255)<<
b%32;return a}function r(c){return p(n(q(c),8*c.length))}function w(c,b){var a,h=q(c),k=[],l=[];k[15]=l[15]=void 0;16<h.length&&(h=n(h,8*c.length));for(a=0;16>a;a+=1)k[a]=h[a]^909522486,l[a]=h[a]^1549556828;a=n(k.concat(q(b)),512+8*b.length);return p(n(l.concat(a),640))}function v(c){var b="",a,h;for(h=0;h<c.length;h+=1)a=c.charCodeAt(h),b+="0123456789abcdef".charAt(a>>>4&15)+"0123456789abcdef".charAt(a&15);return b}return function(c,b,a){b?a?c=w(unescape(encodeURIComponent(b)),unescape(encodeURIComponent(c))):
(c=w(unescape(encodeURIComponent(b)),unescape(encodeURIComponent(c))),c=v(c)):c=a?r(unescape(encodeURIComponent(c))):v(r(unescape(encodeURIComponent(c))));return c}}();return{init:function(b){var k={name:"default"};if("object"===typeof b)for(var h in b)k[h]=b[h];else throw Error("Invalid parameters for init()");return w(k)},createLogStream:w,to:function(b){if(!q.hasOwnProperty(b))throw Error("Invalid name for logStream");return q[b]},destroy:function(b){"undefined"===typeof b&&(b="default");delete q[b]},
log:function(){for(var b in q)q[b].log.apply(this,arguments)}}});
