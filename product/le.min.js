/*
 Copyright 2013 Logentries.
 Please view license at https://raw.github.com/logentries/le_js/master/LICENSE
*/
'use strict';(function(p,t){"function"===typeof define&&define.amd?define(function(){return t(p)}):"object"===typeof exports?("object"===typeof global&&(p=global),module.exports=t(p)):p.TT=t(p)})(this,function(p){function t(h){var k=h.token,a=h.print,l=h.build,m=h.userId,n=h.userName,q=h.sessionId,x=h.device;if(null===x||"undefined"===typeof x)x="Browser: "+p.navigator.userAgent;var y;y=p.TTENDPOINT?p.TTENDPOINT:"api.traintracks.io/v1/events";var t;t="undefined"===typeof XDomainRequest?h.ssl:"https:"===
p.location.protocol?!0:!1;var v=[],c=!1,r=function(){try{console.warn.apply(console,arguments)}catch(c){console.log.apply(console,arguments)}};this.log=function(h,z){if(!arguments.length)throw Error("No arguments!");if(!h||"string"!==typeof h)throw Error("Event type is required and should be string");var u={clientTimestamp:A(new Date),device:x,userId:m,userName:n,sessionId:q,build:l,eventType:h,data:z};return{level:function(l){if(a&&"undefined"!==typeof console&&"PAGE"!==l)try{console[l.toLowerCase()].call(console,
u)}catch(f){console.log(u)}u.level=l;return{send:function(){if("object"!==typeof u.data||u.data instanceof Array||null===u.data)r(h+" won't be sent since event is not an object");else{var e=[],d=JSON.stringify(u,function(c,b){if("undefined"===typeof b)return"undefined";if("object"===typeof b&&null!==b){var d;a:{for(d=0;d<e.length;d++)if(b===e[d])break a;d=-1}if(-1!==d)return"<?>";e.push(b)}return b});c?v.push(d):b(k,d)}}}}}};var b=function(r,h){c=!0;var a;a="undefined"!==typeof XDomainRequest?new XDomainRequest:
new XMLHttpRequest;a.constructor===XMLHttpRequest?a.onreadystatechange=function(){4===a.readyState&&(400<=a.status?(console.error("Couldn't submit events."),410===a.status&&console.warn("This version of le_js is no longer supported!")):(301===a.status&&console.warn("This version of le_js is deprecated! Consider upgrading."),0<v.length?b(r,v.shift()):c=!1))}:a.onload=function(){0<v.length?(b(r,v),v=[]):c=!1};a.open("POST",(t?"https://":"http://")+y,!0);a.constructor===XMLHttpRequest&&(a.setRequestHeader("X-Requested-With",
"XMLHttpRequest"),a.setRequestHeader("Content-type","application/json;charset=utf-8"),a.setRequestHeader("X-Product-Key",r),a.setRequestHeader("X-Product-Auth",B(h+r)));a.send(h)}}function C(h){function k(a,h){if("string"===typeof a&&a.length||"number"===typeof a)return a.toString();throw Error(h+" is required and should be a string");}var a,l={ssl:!0,print:!1,endpoint:null,token:null,userId:null,userName:null,sessionId:null,build:null,device:null},m={token:k,userId:k,userName:k,sessionId:k,build:k},
n;if("object"===typeof h)for(n in h)l[n]=h[n];else throw Error("Invalid parameters for createLogStream()");for(n in m)l[n]=m[n](l[n],n);a=new t(l);var p=function(h){if(a)return a.log.apply(this,arguments);throw Error("You must call TT.init(...) first.");};return{log:function(){p.apply(this,arguments).level("LOG").send()}}}var q={},w=function(h){if("string"!==typeof h.name)throw Error("Name not present.");if(q.hasOwnProperty(h.name))throw Error("A logger with that name already exists!");q[h.name]=
new C(h);return!0},A=function(){function h(a,h,k){for(var n=""+Math.abs(a);n.length<h;)n="0"+n;return(0<=a?k?"+":"":"-")+n}function k(a){a=+a;var h=0;0!==a&&isFinite(a)&&(h=0<=a?Math.floor(a):Math.ceil(a));return h}return function(a){var l=a.getFullYear()+"-"+h(a.getMonth()+1,2)+"-"+h(a.getDate(),2)+"T"+h(a.getHours(),2)+":"+h(a.getMinutes(),2)+":"+h(a.getSeconds(),2)+"."+h(k(1E3*a.getMilliseconds()),6);a=15*-Math.round(a.getTimezoneOffset()/15);var m="+";0>a&&(a=-a,m="-");a=m+h(k(a/60),2)+":"+h(k(a)%
60,2);return l+a}}(),B=function(){function h(c,a){var b=(c&65535)+(a&65535);return(c>>16)+(a>>16)+(b>>16)<<16|b&65535}function k(c,a,b,k,l,m){c=h(h(a,c),h(k,m));return h(c<<l|c>>>32-l,b)}function a(c,a,b,h,l,m,n){return k(a&b|~a&h,c,a,l,m,n)}function l(c,a,b,h,l,m,n){return k(a&h|b&~h,c,a,l,m,n)}function m(c,a,b,h,l,m,n){return k(b^(a|~h),c,a,l,m,n)}function n(c,r){c[r>>5]|=128<<r%32;c[(r+64>>>9<<4)+14]=r;var b,n,p,u,q,f=1732584193,e=-271733879,d=-1732584194,g=271733878;for(b=0;b<c.length;b+=16)n=
f,p=e,u=d,q=g,f=a(f,e,d,g,c[b],7,-680876936),g=a(g,f,e,d,c[b+1],12,-389564586),d=a(d,g,f,e,c[b+2],17,606105819),e=a(e,d,g,f,c[b+3],22,-1044525330),f=a(f,e,d,g,c[b+4],7,-176418897),g=a(g,f,e,d,c[b+5],12,1200080426),d=a(d,g,f,e,c[b+6],17,-1473231341),e=a(e,d,g,f,c[b+7],22,-45705983),f=a(f,e,d,g,c[b+8],7,1770035416),g=a(g,f,e,d,c[b+9],12,-1958414417),d=a(d,g,f,e,c[b+10],17,-42063),e=a(e,d,g,f,c[b+11],22,-1990404162),f=a(f,e,d,g,c[b+12],7,1804603682),g=a(g,f,e,d,c[b+13],12,-40341101),d=a(d,g,f,e,c[b+
14],17,-1502002290),e=a(e,d,g,f,c[b+15],22,1236535329),f=l(f,e,d,g,c[b+1],5,-165796510),g=l(g,f,e,d,c[b+6],9,-1069501632),d=l(d,g,f,e,c[b+11],14,643717713),e=l(e,d,g,f,c[b],20,-373897302),f=l(f,e,d,g,c[b+5],5,-701558691),g=l(g,f,e,d,c[b+10],9,38016083),d=l(d,g,f,e,c[b+15],14,-660478335),e=l(e,d,g,f,c[b+4],20,-405537848),f=l(f,e,d,g,c[b+9],5,568446438),g=l(g,f,e,d,c[b+14],9,-1019803690),d=l(d,g,f,e,c[b+3],14,-187363961),e=l(e,d,g,f,c[b+8],20,1163531501),f=l(f,e,d,g,c[b+13],5,-1444681467),g=l(g,f,e,
d,c[b+2],9,-51403784),d=l(d,g,f,e,c[b+7],14,1735328473),e=l(e,d,g,f,c[b+12],20,-1926607734),f=k(e^d^g,f,e,c[b+5],4,-378558),g=k(f^e^d,g,f,c[b+8],11,-2022574463),d=k(g^f^e,d,g,c[b+11],16,1839030562),e=k(d^g^f,e,d,c[b+14],23,-35309556),f=k(e^d^g,f,e,c[b+1],4,-1530992060),g=k(f^e^d,g,f,c[b+4],11,1272893353),d=k(g^f^e,d,g,c[b+7],16,-155497632),e=k(d^g^f,e,d,c[b+10],23,-1094730640),f=k(e^d^g,f,e,c[b+13],4,681279174),g=k(f^e^d,g,f,c[b],11,-358537222),d=k(g^f^e,d,g,c[b+3],16,-722521979),e=k(d^g^f,e,d,c[b+
6],23,76029189),f=k(e^d^g,f,e,c[b+9],4,-640364487),g=k(f^e^d,g,f,c[b+12],11,-421815835),d=k(g^f^e,d,g,c[b+15],16,530742520),e=k(d^g^f,e,d,c[b+2],23,-995338651),f=m(f,e,d,g,c[b],6,-198630844),g=m(g,f,e,d,c[b+7],10,1126891415),d=m(d,g,f,e,c[b+14],15,-1416354905),e=m(e,d,g,f,c[b+5],21,-57434055),f=m(f,e,d,g,c[b+12],6,1700485571),g=m(g,f,e,d,c[b+3],10,-1894986606),d=m(d,g,f,e,c[b+10],15,-1051523),e=m(e,d,g,f,c[b+1],21,-2054922799),f=m(f,e,d,g,c[b+8],6,1873313359),g=m(g,f,e,d,c[b+15],10,-30611744),d=m(d,
g,f,e,c[b+6],15,-1560198380),e=m(e,d,g,f,c[b+13],21,1309151649),f=m(f,e,d,g,c[b+4],6,-145523070),g=m(g,f,e,d,c[b+11],10,-1120210379),d=m(d,g,f,e,c[b+2],15,718787259),e=m(e,d,g,f,c[b+9],21,-343485551),f=h(f,n),e=h(e,p),d=h(d,u),g=h(g,q);return[f,e,d,g]}function p(c){var a,b="";for(a=0;a<32*c.length;a+=8)b+=String.fromCharCode(c[a>>5]>>>a%32&255);return b}function q(c){var a,b=[];b[(c.length>>2)-1]=void 0;for(a=0;a<b.length;a+=1)b[a]=0;for(a=0;a<8*c.length;a+=8)b[a>>5]|=(c.charCodeAt(a/8)&255)<<a%32;
return b}function t(c){return p(n(q(c),8*c.length))}function w(c,a){var b,h=q(c),k=[],l=[];k[15]=l[15]=void 0;16<h.length&&(h=n(h,8*c.length));for(b=0;16>b;b+=1)k[b]=h[b]^909522486,l[b]=h[b]^1549556828;b=n(k.concat(q(a)),512+8*a.length);return p(n(l.concat(b),640))}function v(c){var a="",b,h;for(h=0;h<c.length;h+=1)b=c.charCodeAt(h),a+="0123456789abcdef".charAt(b>>>4&15)+"0123456789abcdef".charAt(b&15);return a}return function(a,h,b){h?b?a=w(unescape(encodeURIComponent(h)),unescape(encodeURIComponent(a))):
(a=w(unescape(encodeURIComponent(h)),unescape(encodeURIComponent(a))),a=v(a)):a=b?t(unescape(encodeURIComponent(a))):v(t(unescape(encodeURIComponent(a))));return a}}();return{init:function(h){var k={name:"default"};if("object"===typeof h)for(var a in h)k[a]=h[a];else throw Error("Invalid parameters for init()");return w(k)},createLogStream:w,to:function(h){if(!q.hasOwnProperty(h))throw Error("Invalid name for logStream");return q[h]},destroy:function(h){"undefined"===typeof h&&(h="default");delete q[h]},
log:function(){for(var h in q)q[h].log.apply(this,arguments)}}});
